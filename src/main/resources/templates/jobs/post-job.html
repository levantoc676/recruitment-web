<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width,initial-scale=1" name="viewport">
  <title>Đăng tin tuyển dụng</title>
  <link rel="stylesheet" th:href="@{/css/style.css}">
  <link rel="stylesheet" th:href="@{/css/auth-login.css}">
  <!-- Bootstrap CSS (CDN) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet">
  <style>
    /* Ví dụ: chừa khoảng cho header cố định */
    body {
      padding-top: 80px; /* điều chỉnh theo chiều cao header */
    }

    /* Style riêng cho nội dung job-detail */
    #job-description p {
      line-height: 1.7;
    }
  </style>
</head>
<body>
<div th:insert="~{layout/header_jobs_create :: header_jobs_create}"></div>
<div class="container py-4">
  <h2 class="mb-4">Đăng tin tuyển dụng</h2>

  <form enctype="multipart/form-data"
        method="post"
        th:action="${job.jobId == null} ? @{/jobs/create} : @{/jobs/update/{id}(id=${job.jobId})}"
        th:object="${job}">

    <!-- If you use Spring Security CSRF, uncomment:
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/> -->
    <!-- Hidden employer id (set from controller) -->

    <div class="row g-3">
      <div class="col-md-8">
        <label class="form-label">Tiêu đề công việc <span class="text-danger">*</span></label>
        <input class="form-control" placeholder="Ví dụ: Java Developer" required
               th:field="*{title}" type="text">

        <label class="form-label mt-3">Mô tả công việc <span class="text-danger">*</span></label>
        <textarea class="form-control"
                  placeholder="Mô tả chi tiết nhiệm vụ, công nghệ, môi trường..." required
                  rows="6"
                  th:field="*{description}"></textarea>

        <div class="row mt-3">
          <div class="col-md-6">
            <label class="form-label">Yêu cầu (Requirements)</label>
            <textarea class="form-control" placeholder="Kinh nghiệm, bằng cấp, kỹ năng..." rows="4"
                      th:field="*{requirements}"></textarea>
          </div>
          <div class="col-md-6">
            <label class="form-label">Quyền lợi (Benefits)</label>
            <textarea class="form-control" placeholder="Lương, thưởng, bảo hiểm, đào tạo..."
                      rows="4"
                      th:field="*{benefits}"></textarea>
          </div>
        </div>

        <label class="form-label mt-3">Kỹ năng (thêm nhiều tags)</label>
        <div class="mb-2">
          <div id="skillTags"></div>
          <div class="input-group">
            <input class="form-control" id="skillInput"
                   placeholder="Nhập kỹ năng rồi nhấn Enter hoặc nút Thêm"
                   type="text">
            <button class="btn btn-outline-secondary" id="addSkillBtn" type="button">Thêm</button>
          </div>
          <!-- hidden input gửi lên server (comma separated) -->
          <input id="skillsHidden" th:field="*{skills}" type="hidden"/>
        </div>

        <label class="form-label mt-3">Hình ảnh/Logo công ty</label>
        <input accept="image/*" class="form-control" id="logoFile" name="logoFile" type="file">
        <div class="mt-2">
          <img alt="Logo preview" class="logo-preview d-none" id="logoPreview">
        </div>
      </div>

      <aside class="col-md-4">
        <div class="card p-3 mb-3">
          <label class="form-label">Địa điểm <span class="text-danger">*</span></label>
          <input class="form-control" placeholder="Hồ Chí Minh, Hà Nội, Remote..." required
                 th:field="*{location}" type="text">

          <!--          <label class="form-label mt-3">Loại công việc</label>-->
          <!--          <select class="form-select" th:field="*{jobType}">-->
          <!--            &lt;!&ndash; Giá trị mặc định rỗng &ndash;&gt;-->
          <!--            <option th:value="">&#45;&#45; Chọn &#45;&#45;</option>-->
          <!--            <option th:value="'Full-time'">Full-time</option>-->
          <!--            <option th:value="'Part-time'">Part-time</option>-->
          <!--            <option th:value="'Internship'">Internship</option>-->
          <!--            <option th:value="'Contract'">Contract</option>-->
          <!--            <option th:value="'Remote'">Remote</option>-->
          <!--          </select>-->


          <label class="form-label mt-3">Mức lương</label>
          <input class="form-control" placeholder="Ví dụ: 15-25 triệu / thỏa thuận"
                 th:field="*{salaryRange}"
                 type="text">

          <label class="form-label mt-3">Số lượng tuyển</label>
          <input class="form-control" min="1" placeholder="1" th:field="*{headcount}" type="number">

          <label class="form-label mt-3">Kinh nghiệm</label>
          <!--          <select class="form-select" th:field="*{experienceLevel}">-->
          <!--            <option th:value="">&#45;&#45; Chọn &#45;&#45;</option>-->
          <!--            <option>Fresher (0-1 năm)</option>-->
          <!--            <option>Junior (1-3 năm)</option>-->
          <!--            <option>Mid (3-5 năm)</option>-->
          <!--            <option>Senior (5+ năm)</option>-->
          <!--          </select>-->

          <label class="form-label mt-3">Ngành nghề</label>
          <input class="form-control" placeholder="IT, Kinh doanh, Marketing..."
                 th:field="*{industry}"
                 type="text">

          <label class="form-label mt-3">Hạn nộp hồ sơ</label>
          <input class="form-control" th:field="*{deadline}" type="date">

          <label class="form-label mt-3">Phương thức ứng tuyển</label>
          <!--          <select class="form-select" th:field="*{applicationMethod}">-->
          <!--            <option>Email</option>-->
          <!--            <option>Website</option>-->
          <!--            <option>Walk-in</option>-->
          <!--          </select>-->

          <label class="form-label mt-3">Email liên hệ</label>
          <input class="form-control" placeholder="hr@company.com" th:field="*{contactEmail}"
                 type="email">

          <label class="form-label mt-3">Số điện thoại</label>
          <input class="form-control" placeholder="0123456789" th:field="*{contactPhone}"
                 type="tel">
        </div>

        <div class="d-grid">
          <button class="btn btn-primary btn-lg" th:text="${job.jobId == null} ? 'Đăng tuyển' : 'Cập nhật'"
                  type="submit">
            Đăng tuyển
          </button>
        </div>

      </aside>
    </div>
  </form>
</div>

<!-- Bootstrap JS + Popper (CDN) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // Skill tags logic
  const skillInput = document.getElementById('skillInput');
  const addSkillBtn = document.getElementById('addSkillBtn');
  const skillTags = document.getElementById('skillTags');
  const skillsHidden = document.getElementById('skillsHidden');

  let skills = [];

  function renderSkills() {
    skillTags.innerHTML = '';
    skills.forEach((s, idx) => {
      const span = document.createElement('span');
      span.className = 'tag';
      span.textContent = s;
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.textContent = '×';
      btn.onclick = () => { skills.splice(idx, 1); updateHidden(); renderSkills(); };
      span.appendChild(btn);
      skillTags.appendChild(span);
    });
    updateHidden();
  }

  function updateHidden() {
    skillsHidden.value = skills.join(',');
  }

  addSkillBtn.addEventListener('click', () => {
    const v = skillInput.value.trim();
    if (v && !skills.includes(v)) {
      skills.push(v);
      skillInput.value = '';
      renderSkills();
    }
  });

  skillInput.addEventListener('keyup', (e) => {
    if (e.key === 'Enter') {
      addSkillBtn.click();
      e.preventDefault();
    }
  });

  // Logo preview
  const logoFile = document.getElementById('logoFile');
  const logoPreview = document.getElementById('logoPreview');

  logoFile.addEventListener('change', () => {
    const f = logoFile.files[0];
    if (!f) { logoPreview.classList.add('d-none'); return; }
    const reader = new FileReader();
    reader.onload = function(e) {
      logoPreview.src = e.target.result;
      logoPreview.classList.remove('d-none');
    }
    reader.readAsDataURL(f);
  });
</script>
</body>
</html>
